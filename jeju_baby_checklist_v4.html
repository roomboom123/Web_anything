<!doctype html>
<html lang="ko">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>ì œì£¼ 4ë°•5ì¼ | ì‹ ìƒì•„ ë™ë°˜ ì²´í¬ë¦¬ìŠ¤íŠ¸</title>
  <style>
    :root{
      --bg:#0b0f14;
      --card:#121826;
      --muted:#9aa4b2;
      --text:#e5e7eb;
      --accent:#60a5fa;
      --line:#243044;
      --soft: rgba(255,255,255,.03);
      --ok: rgba(52,211,153,.9);
      --warn: rgba(251,191,36,.95);
      --danger: rgba(251,113,133,.95);
    }
    *{box-sizing:border-box}
    body{
      margin:0;
      font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, "Apple SD Gothic Neo", "Noto Sans KR", Arial, sans-serif;
      background: radial-gradient(1200px 600px at 20% -10%, rgba(96,165,250,.25), transparent 55%),
                  radial-gradient(900px 500px at 90% 0%, rgba(52,211,153,.18), transparent 50%),
                  var(--bg);
      color:var(--text);
    }
    header{padding:28px 16px 10px; max-width: 980px; margin: 0 auto;}
    h1{margin:0 0 6px 0; font-size: 22px; letter-spacing: -0.2px;}
    .sub{margin:0; color:var(--muted); font-size: 13px; line-height: 1.5;}
    .toolbar{margin-top:14px; display:flex; gap:10px; flex-wrap:wrap; align-items:center;}
    button{
      border:1px solid var(--line);
      background: var(--soft);
      color:var(--text);
      padding:10px 12px;
      border-radius: 12px;
      cursor:pointer;
      font-size: 13px;
    }
    button:hover{border-color: rgba(96,165,250,.6)}
    .btn-share{border-color: rgba(52,211,153,.7); background: rgba(52,211,153,.18);}
    .pill{
      font-size: 12px; padding:6px 10px; border-radius:999px;
      border:1px solid var(--line); background: var(--soft); color: var(--muted);
    }
    .wrap{
      max-width: 980px; margin: 0 auto; padding: 12px 16px 40px;
      display:grid; grid-template-columns: 1fr; gap: 14px;
    }
    @media (min-width: 900px){
      .wrap{grid-template-columns: 1fr 1fr;}
      .full{grid-column: 1 / -1;}
    }
    .card{
      background: rgba(18,24,38,.92);
      border: 1px solid var(--line);
      border-radius: 18px;
      padding: 14px 14px 10px;
      box-shadow: 0 10px 30px rgba(0,0,0,.25);
    }
    .card h2{
      margin:0 0 8px 0; font-size: 16px;
      display:flex; align-items:center; justify-content:space-between; gap:10px;
    }
    .meta{display:flex; gap:8px; flex-wrap:wrap; align-items:center;}
    .tag{
      font-size: 11px; padding: 4px 8px; border-radius: 999px;
      border: 1px solid var(--line); color: var(--muted); background: rgba(255,255,255,.02);
    }
    .tag.accent{border-color: rgba(96,165,250,.55); color: rgba(147,197,253,.95)}
    .tag.ok{border-color: rgba(52,211,153,.55); color: rgba(110,231,183,.95)}
    .tag.warn{border-color: rgba(251,191,36,.55); color: rgba(253,230,138,.95)}
    .tag.danger{border-color: rgba(251,113,133,.55); color: rgba(253,164,175,.95)}
    .section{border-top: 1px dashed rgba(154,164,178,.22); padding-top: 10px; margin-top: 10px;}
    .section h3{margin:0 0 8px 0; font-size: 13px; color: rgba(229,231,235,.92); letter-spacing: -0.1px;}
    ul{list-style:none; padding:0; margin:0}
    li{display:flex; gap:10px; align-items:flex-start; padding:8px 6px; border-radius: 12px;}
    li:hover{background: rgba(255,255,255,.03)}
    input[type="checkbox"]{
      margin-top: 3px; width: 18px; height: 18px; accent-color: var(--accent);
      flex: 0 0 auto; cursor:pointer;
    }
    .item{flex:1 1 auto; display:flex; flex-direction:column; gap:3px; line-height:1.35;}
    .name{font-size: 13px; color: var(--text);}
    .note{font-size: 12px; color: var(--muted);}
    .hint{margin-top: 12px; font-size: 12px; color: var(--muted); line-height: 1.6;}
    .progress{
      font-size: 12px; color: var(--muted);
      display:flex; align-items:center; gap:8px; white-space:nowrap;
    }
    .bar{
      width: 120px; height: 8px; background: rgba(255,255,255,.06);
      border:1px solid rgba(154,164,178,.18); border-radius:999px; overflow:hidden;
    }
    .fill{height:100%; width:0%; background: linear-gradient(90deg, rgba(96,165,250,.95), rgba(52,211,153,.85));}
    .tiny{font-size:11px; color: var(--muted); margin:10px 0 0;}
    .addbox{
      margin-top: 10px;
      padding: 12px;
      border-radius: 14px;
      border: 1px solid rgba(154,164,178,.18);
      background: rgba(255,255,255,.02);
    }
    .addgrid{
      display:grid;
      grid-template-columns: 1fr;
      gap: 10px;
    }
    @media (min-width: 700px){
      .addgrid{grid-template-columns: 1.2fr 1fr 1fr auto;}
    }
    .field{display:flex; flex-direction:column; gap:6px;}
    label{font-size: 11px; color: var(--muted);}
    input[type="text"], select{
      width:100%;
      padding:10px 10px;
      border-radius: 12px;
      border: 1px solid rgba(154,164,178,.22);
      background: rgba(0,0,0,.22);
      color: var(--text);
      outline: none;
      font-size: 13px;
    }
    input[type="text"]::placeholder{color: rgba(154,164,178,.6)}
    .btn-primary{border-color: rgba(96,165,250,.7); background: rgba(96,165,250,.18);}
    .btn-danger{border-color: rgba(251,113,133,.65); background: rgba(251,113,133,.14);}
    .btn-edit{border-color: rgba(251,191,36,.65); background: rgba(251,191,36,.14);}
    .row-actions{display:flex; gap:6px; align-items:center; margin-left:auto;}
    .iconbtn{padding:6px 8px; font-size:11px; border-radius: 8px;}
    .toast{
      position: fixed;
      left: 50%;
      bottom: 18px;
      transform: translateX(-50%);
      padding: 10px 12px;
      border-radius: 999px;
      border: 1px solid rgba(154,164,178,.22);
      background: rgba(18,24,38,.96);
      color: var(--text);
      font-size: 12px;
      opacity: 0;
      pointer-events:none;
      transition: opacity .18s ease;
      box-shadow: 0 10px 30px rgba(0,0,0,.35);
      z-index: 1000;
    }
    .toast.show{opacity: 1;}
    /* Modal */
    .modal-overlay{
      position: fixed;
      top: 0; left: 0; right: 0; bottom: 0;
      background: rgba(0,0,0,.7);
      display: none;
      align-items: center;
      justify-content: center;
      z-index: 999;
      padding: 16px;
    }
    .modal-overlay.show{display: flex;}
    .modal{
      background: var(--card);
      border: 1px solid var(--line);
      border-radius: 18px;
      padding: 20px;
      width: 100%;
      max-width: 400px;
      box-shadow: 0 20px 50px rgba(0,0,0,.5);
    }
    .modal h3{margin: 0 0 16px 0; font-size: 16px;}
    .modal .field{margin-bottom: 12px;}
    .modal-actions{display: flex; gap: 10px; margin-top: 16px;}
    .modal-actions button{flex: 1;}
    @media print{
      body{background:#fff; color:#111827}
      .card{background:#fff; border-color:#e5e7eb; box-shadow:none}
      button{display:none}
      .pill{border-color:#e5e7eb; color:#374151; background:#fff}
      .tag{border-color:#e5e7eb; color:#374151}
      .name{color:#111827}
      .note,.sub,.hint,.progress,.tiny,label{color:#374151}
      input[type="checkbox"]{accent-color:#111827}
      .addbox{display:none}
      .toast{display:none}
      .modal-overlay{display:none}
    }
  </style>
</head>
<body>
  <header>
    <h1>ì œì£¼ 4ë°• 5ì¼ | ì‹ ìƒì•„ ë™ë°˜ ì²´í¬ë¦¬ìŠ¤íŠ¸</h1>
    <p class="sub">
      ë¹„í–‰ê¸° + ë Œí„°ì¹´ + í˜¸í…” / ë³´í˜¸ì 2ì¸ ê¸°ì¤€.<br>
      ì²´í¬ ìƒíƒœëŠ” ê°ì ê¸°ê¸°ì— ì €ì¥ë©ë‹ˆë‹¤. ê³µìœ í•˜ë ¤ë©´ "ğŸ“¤ ìƒíƒœ ê³µìœ " ë²„íŠ¼ì„ ëˆŒëŸ¬ì£¼ì„¸ìš”.
    </p>
    <div class="toolbar">
      <button type="button" onclick="checkAll(true)">ì „ì²´ ì²´í¬</button>
      <button type="button" onclick="checkAll(false)">ì „ì²´ í•´ì œ</button>
      <button type="button" class="btn-share" onclick="shareState()">ğŸ“¤ ìƒíƒœ ê³µìœ </button>
      <button type="button" onclick="exportBackup()">ğŸ’¾ ë°±ì—… ì €ì¥</button>
      <button type="button" onclick="triggerImport()">ğŸ“‚ ë°±ì—… ë¶ˆëŸ¬ì˜¤ê¸°</button>
      <button type="button" onclick="window.print()">ğŸ–¨ï¸ ì¸ì‡„</button>
      <span class="pill" id="overall">ì§„í–‰ë¥  ê³„ì‚° ì¤‘â€¦</span>
    </div>
    <p class="tiny">â€» ë¶€ëª¨ ì˜ë¥˜/ì†ì˜·ì€ "4ë°• 5ì¼(5ì¼ì¹˜) + ì˜ˆë¹„ 1" ê¸°ì¤€.</p>
  </header>

  <main class="wrap">
    <section class="card full" data-card="custom_add">
      <h2>â• ì¤€ë¹„ë¬¼ ì¶”ê°€ <span class="progress"><span class="bar"><span class="fill"></span></span><span class="pct">â€”</span></span></h2>
      <div class="meta">
        <span class="tag accent">ì»¤ìŠ¤í…€</span>
        <span class="tag ok">ì¶”ê°€/ìˆ˜ì •/ì‚­ì œ ê°€ëŠ¥</span>
      </div>
      <div class="addbox">
        <div class="addgrid">
          <div class="field">
            <label for="add_name">ì¶”ê°€í•  ë¬¼ê±´</label>
            <input id="add_name" type="text" placeholder="ì˜ˆ: ì—¬ë²Œ ì‹ ë°œëˆ, ë©€í‹°íƒ­â€¦" />
          </div>
          <div class="field">
            <label for="add_note">ë©”ëª¨(ì„ íƒ)</label>
            <input id="add_note" type="text" placeholder="ì˜ˆ: í˜¸í…”ì—ì„œ í•„ìš”" />
          </div>
          <div class="field">
            <label for="add_category">ì¹´í…Œê³ ë¦¬</label>
            <select id="add_category">
              <option value="custom_baby">ì•„ê¸° | ì¶”ê°€</option>
              <option value="custom_mom">ì—„ë§ˆ | ì¶”ê°€</option>
              <option value="custom_dad">ì•„ë¹  | ì¶”ê°€</option>
              <option value="custom_shared">ê³µìš© | ì¶”ê°€</option>
            </select>
          </div>
          <div class="field">
            <label>&nbsp;</label>
            <button class="btn-primary" type="button" onclick="addCustomItem()">ì¶”ê°€</button>
          </div>
        </div>
      </div>
    </section>

    <section class="card" data-card="custom_baby">
      <h2>ğŸ§· ì•„ê¸° | ë‚´ê°€ ì¶”ê°€ <span class="progress"><span class="bar"><span class="fill"></span></span><span class="pct">0%</span></span></h2>
      <div class="meta"><span class="tag accent">ì»¤ìŠ¤í…€</span></div>
      <ul id="list_custom_baby"></ul>
      <p class="hint" id="empty_custom_baby">ì•„ì§ ì¶”ê°€í•œ í•­ëª©ì´ ì—†ì–´ìš”.</p>
    </section>

    <section class="card" data-card="custom_mom">
      <h2>ğŸ§· ì—„ë§ˆ | ë‚´ê°€ ì¶”ê°€ <span class="progress"><span class="bar"><span class="fill"></span></span><span class="pct">0%</span></span></h2>
      <div class="meta"><span class="tag accent">ì»¤ìŠ¤í…€</span></div>
      <ul id="list_custom_mom"></ul>
      <p class="hint" id="empty_custom_mom">ì•„ì§ ì¶”ê°€í•œ í•­ëª©ì´ ì—†ì–´ìš”.</p>
    </section>

    <section class="card" data-card="custom_dad">
      <h2>ğŸ§· ì•„ë¹  | ë‚´ê°€ ì¶”ê°€ <span class="progress"><span class="bar"><span class="fill"></span></span><span class="pct">0%</span></span></h2>
      <div class="meta"><span class="tag accent">ì»¤ìŠ¤í…€</span></div>
      <ul id="list_custom_dad"></ul>
      <p class="hint" id="empty_custom_dad">ì•„ì§ ì¶”ê°€í•œ í•­ëª©ì´ ì—†ì–´ìš”.</p>
    </section>

    <section class="card" data-card="custom_shared">
      <h2>ğŸ§· ê³µìš© | ë‚´ê°€ ì¶”ê°€ <span class="progress"><span class="bar"><span class="fill"></span></span><span class="pct">0%</span></span></h2>
      <div class="meta"><span class="tag accent">ì»¤ìŠ¤í…€</span></div>
      <ul id="list_custom_shared"></ul>
      <p class="hint" id="empty_custom_shared">ì•„ì§ ì¶”ê°€í•œ í•­ëª©ì´ ì—†ì–´ìš”.</p>
    </section>

    <!-- ê¸°ë‚´ ë°˜ì… -->
    <section class="card full" data-card="carry">
      <h2>âœˆï¸ ê¸°ë‚´ ë°˜ì…(ì¦‰ì‹œ ëŒ€ì‘ í‚¤íŠ¸) <span class="progress"><span class="bar"><span class="fill"></span></span><span class="pct">0%</span></span></h2>
      <div class="meta"><span class="tag accent">ìš°ì„ ìˆœìœ„ ìµœìƒ</span><span class="tag warn">ì¦‰ì‹œ ëŒ€ì‘</span></div>

      <div class="section">
        <h3>ì•„ê¸°</h3>
        <ul>
          <li><input type="checkbox" data-key="carry_baby_diaper"><div class="item"><div class="name">ê¸°ì €ê·€ (ê¸°ë‚´ìš© 6~10ê°œ)</div><div class="note">ì§€ì—°/í™˜ìŠ¹ ëŒ€ë¹„</div></div></li>
          <li><input type="checkbox" data-key="carry_baby_wipes"><div class="item"><div class="name">íœ´ëŒ€ìš© ë¬¼í‹°ìŠˆ 2~3íŒ© + íœ´ì§€</div><div class="note">ì†/ì–¼êµ´/ê¸°ì €ê·€</div></div></li>
          <li><input type="checkbox" data-key="carry_baby_change"><div class="item"><div class="name">ì—¬ë²Œ ì˜· 1ì„¸íŠ¸ + ì†ì‹¸ê°œ/ë‹´ìš” 1</div><div class="note">í† /ì—­ë¥˜/ëˆ„ìˆ˜</div></div></li>
          <li><input type="checkbox" data-key="carry_baby_pad"><div class="item"><div class="name">ê¸°ì €ê·€ êµí™˜ íŒ¨ë“œ(ê¹”ê°œ)</div><div class="note">ê¸°ë‚´/ê³µí•­</div></div></li>
          <li><input type="checkbox" data-key="carry_baby_toys"><div class="item"><div class="name">í¡ì°© ì¥ë‚œê° 1 + í—ê²Šì±… 1 + ì¹˜ë°œê¸°</div><div class="note">ì§§ê³  í™•ì‹¤í•œ 3ì¢…</div></div></li>
        </ul>
      </div>

      <div class="section">
        <h3>ë¶€ëª¨</h3>
        <ul>
          <li><input type="checkbox" data-key="carry_id"><div class="item"><div class="name">ì‹ ë¶„ì¦/ë©´í—ˆì¦/ì¹´ë“œ</div><div class="note">ë Œí„°ì¹´ ì¸ìˆ˜ê¹Œì§€</div></div></li>
          <li><input type="checkbox" data-key="carry_charger"><div class="item"><div class="name">ì¶©ì „ê¸° + ë³´ì¡°ë°°í„°ë¦¬</div><div class="note">ì‚¬ì§„/ì§€ë„/ì—…ë¬´</div></div></li>
          <li><input type="checkbox" data-key="carry_parent_change"><div class="item"><div class="name">ë¶€ëª¨ ì—¬ë²Œ í‹°ì…”ì¸  1(ê° 1) + ì§€í¼ë°±</div><div class="note">ì•„ê¸° ì‚¬ê³  ëŒ€ë¹„</div></div></li>
          <li><input type="checkbox" data-key="carry_sanitizer"><div class="item"><div class="name">ì†ì†Œë…ì œ/íœ´ëŒ€ìš© ì†ì›Œì‹œ</div><div class="note">ì ‘ì´‰ ë§ì„ ë•Œ</div></div></li>
        </ul>
      </div>
    </section>

    <!-- ì•„ê¸° ì˜ë¥˜ -->
    <section class="card" data-card="baby_clothes">
      <h2>ğŸ‘¶ ì•„ê¸° | ì˜ë¥˜ & ê¸°ì €ê·€ <span class="progress"><span class="bar"><span class="fill"></span></span><span class="pct">0%</span></span></h2>
      <div class="section">
        <h3>ê¸°ì €ê·€</h3>
        <ul>
          <li><input type="checkbox" data-key="baby_day_diaper"><div class="item"><div class="name">ë‚® ê¸°ì €ê·€ ìƒˆê±° 1íŒ©</div><div class="note">ë¶€í”¼ í¬ë©´ í˜„ì§€ ì¡°ë‹¬</div></div></li>
          <li><input type="checkbox" data-key="baby_night_diaper"><div class="item"><div class="name">ë°¤ ê¸°ì €ê·€ 8ê°œ</div><div class="note">í¡ìˆ˜ë ¥ ì¢‹ì€ ê±¸ë¡œ</div></div></li>
          <li><input type="checkbox" data-key="baby_swim_diaper"><div class="item"><div class="name">ë°©ìˆ˜/ìˆ˜ì˜ìš© ê¸°ì €ê·€</div><div class="note">ë¬¼ë†€ì´ ì¼ì • ìˆì„ ë•Œ</div></div></li>
        </ul>
      </div>
      <div class="section">
        <h3>ì˜·/ì¡í™”</h3>
        <ul>
          <li><input type="checkbox" data-key="baby_inner"><div class="item"><div class="name">ë‚´ë³µ</div><div class="note">ì—¬ë²Œ 2~3</div></div></li>
          <li><input type="checkbox" data-key="baby_pajama"><div class="item"><div class="name">ì ì˜·</div><div class="note">ìˆ˜ë©´ ì¤‘ ë•€/ì¹¨ ëŒ€ë¹„</div></div></li>
          <li><input type="checkbox" data-key="baby_outer"><div class="item"><div class="name">ê²‰ì˜·</div><div class="note">ì œì£¼ ë°”ëŒ ëŒ€ë¹„</div></div></li>
          <li><input type="checkbox" data-key="baby_hat_socks"><div class="item"><div class="name">ëª¨ì, ì–‘ë§</div><div class="note">ì²´ì˜¨ ìœ ì§€ìš©</div></div></li>
          <li><input type="checkbox" data-key="baby_swimsuit"><div class="item"><div class="name">ìˆ˜ì˜ë³µ</div><div class="note">ì˜¨ìˆ˜í’€/ìŠ¤íŒŒ ì¼ì • ì‹œ</div></div></li>
          <li><input type="checkbox" data-key="baby_bib_cloth"><div class="item"><div class="name">í„±ë°›ì´(ì²œ)</div><div class="note">ì„¸íƒ ëŒ€ë¹„ 3~5ì¥</div></div></li>
          <li><input type="checkbox" data-key="baby_cloths"><div class="item"><div class="name">ì†ìˆ˜ê±´</div><div class="note">ë„‰ë„‰íˆ</div></div></li>
          <li><input type="checkbox" data-key="baby_swaddle"><div class="item"><div class="name">ì†ì‹¸ê°œ</div><div class="note">ìˆ˜ë©´/ì•ˆì •/ì²´ì˜¨</div></div></li>
        </ul>
      </div>
      <div class="section">
        <h3>ì„¸íƒ</h3>
        <ul>
          <li><input type="checkbox" data-key="baby_laundry_net"><div class="item"><div class="name">ì„¸íƒë§</div><div class="note">í˜¸í…” ì„¸íƒ/ì†ë¹¨ë˜</div></div></li>
          <li><input type="checkbox" data-key="baby_detergent"><div class="item"><div class="name">ì„¸íƒì„¸ì œ</div><div class="note">ì†Œë¶„ ì¶”ì²œ</div></div></li>
        </ul>
      </div>
    </section>

    <!-- ì•„ê¸° ì‹ -->
    <section class="card" data-card="baby_food">
      <h2>ğŸ¼ ì•„ê¸° | ì´ìœ ì‹ <span class="progress"><span class="bar"><span class="fill"></span></span><span class="pct">0%</span></span></h2>
      <div class="section">
        <h3>ìŒì‹</h3>
        <ul>
          <li><input type="checkbox" data-key="baby_food_packs"><div class="item"><div class="name">ì‹¤ì˜¨ ì´ìœ ì‹ 5íŒ©</div><div class="note">ì—¬ë¶„ 1~2íŒ© ì¶”ê°€</div></div></li>
          <li><input type="checkbox" data-key="baby_snack"><div class="item"><div class="name">ë–¡ë»¥(íœ´ëŒ€)</div><div class="note">ì°¨/ë¹„í–‰ê¸°ì—ì„œ ìœ ìš©</div></div></li>
        </ul>
      </div>
      <div class="section">
        <h3>ë„êµ¬</h3>
        <ul>
          <li><input type="checkbox" data-key="baby_spoon_case"><div class="item"><div class="name">ìˆŸê°€ë½ + ì¼€ì´ìŠ¤</div><div class="note">ì™¸ì‹/ì´ë™</div></div></li>
          <li><input type="checkbox" data-key="baby_strawcup"><div class="item"><div class="name">ë¹¨ëŒ€ì»µ</div><div class="note">ëˆ„ìˆ˜ ì ê²Œ</div></div></li>
          <li><input type="checkbox" data-key="baby_bib_silicone"><div class="item"><div class="name">í„±ë°›ì´(ì‹¤ë¦¬ì½˜/ì¼íšŒìš©)</div><div class="note">ì™¸ì¶œì€ ì¼íšŒìš© í¸í•¨</div></div></li>
          <li><input type="checkbox" data-key="baby_thermos"><div class="item"><div class="name">ë³´ì˜¨ë³‘</div><div class="note">ë”°ëœ»í•œ ë¬¼</div></div></li>
          <li><input type="checkbox" data-key="baby_pot"><div class="item"><div class="name">ì „ê¸°í¬íŠ¸</div><div class="note">í˜¸í…” ë¹„ì¹˜ ë¶ˆí™•ì‹¤ ì‹œ</div></div></li>
          <li><input type="checkbox" data-key="baby_dishkit"><div class="item"><div class="name">ì„¤ê±°ì§€(ìˆ˜ì„¸ë¯¸/ì„¸ì œ/ë¹¨ëŒ€ì†”)</div><div class="note">ì†Œë¶„ ì¶”ì²œ</div></div></li>
          <li><input type="checkbox" data-key="baby_food_bag"><div class="item"><div class="name">ì´ìœ ì‹ìš© ê°€ë°©</div><div class="note">ë³´ëƒ‰ë°±ì´ë©´ ì¢‹ìŒ</div></div></li>
        </ul>
      </div>
    </section>

    <!-- ì•„ê¸° ë†€ê¸° -->
    <section class="card" data-card="baby_play">
      <h2>ğŸ§¸ ì•„ê¸° | ë†€ê¸° <span class="progress"><span class="bar"><span class="fill"></span></span><span class="pct">0%</span></span></h2>
      <ul>
        <li><input type="checkbox" data-key="baby_cloth_book"><div class="item"><div class="name">í—ê²Šì±…(íœ´ëŒ€)</div><div class="note">ì†Œë¦¬/ì´‰ê° ìš”ì†Œ</div></div></li>
        <li><input type="checkbox" data-key="baby_tulip"><div class="item"><div class="name">íŠ¤ë¦½ì‹œë¦¬ì¦ˆ</div><div class="note">ìµœì•  ì•„ì´í…œ</div></div></li>
        <li><input type="checkbox" data-key="baby_dolls"><div class="item"><div class="name">ì‘ì€ ì¸í˜•ë“¤</div><div class="note">2ê°œë§Œ ì„ íƒ</div></div></li>
        <li><input type="checkbox" data-key="baby_teether"><div class="item"><div class="name">ì‹¤ë¦¬ì½˜ ìŠ¤íŠ¸ë© + ì¹˜ë°œê¸°</div><div class="note">ë¶„ì‹¤ ë°©ì§€</div></div></li>
        <li><input type="checkbox" data-key="baby_suction_toy"><div class="item"><div class="name">ë¹„í–‰ê¸°ìš© í¡ì°©ì¥ë‚œê°</div><div class="note">ê¸°ë‚´ìš©</div></div></li>
        <li><input type="checkbox" data-key="baby_tube"><div class="item"><div class="name">íŠœë¸Œ</div><div class="note">ê³„íš ìˆì„ ë•Œë§Œ</div></div></li>
      </ul>
    </section>

    <!-- ì•„ê¸° ì”»ê¸° -->
    <section class="card" data-card="baby_wash">
      <h2>ğŸ› ì•„ê¸° | ì”»ê¸° & ìœ„ìƒ <span class="progress"><span class="bar"><span class="fill"></span></span><span class="pct">0%</span></span></h2>
      <ul>
        <li><input type="checkbox" data-key="baby_bodywash"><div class="item"><div class="name">ë°”ë””ì›Œì‹œ</div><div class="note">ì†Œë¶„í•˜ë©´ ê°€ë²¼ì›€</div></div></li>
        <li><input type="checkbox" data-key="baby_tub_cleaner"><div class="item"><div class="name">ìš•ì¡°í´ë¦¬ë„ˆ</div><div class="note">ìš•ì¡° ì‚¬ìš© ì‹œ</div></div></li>
        <li><input type="checkbox" data-key="baby_tooth"><div class="item"><div class="name">ì¹«ì†”/ì¹˜ì•½</div><div class="note">í•„ìš” ì‹œ</div></div></li>
        <li><input type="checkbox" data-key="baby_steril_bowl"><div class="item"><div class="name">ì†Œë…ìš©ìœ ë¦¬ê·¸ë¦‡</div><div class="note">ì—´íƒ• ì†Œë…</div></div></li>
        <li><input type="checkbox" data-key="baby_bumbo"><div class="item"><div class="name">ë²”ë³´ì˜ì</div><div class="note">í˜¸í…”ë°©ì—ì„œ ì ê¹</div></div></li>
        <li><input type="checkbox" data-key="baby_lotion"><div class="item"><div class="name">ë¡œì…˜</div><div class="note">ê±´ì¡°/ë°”ëŒ</div></div></li>
        <li><input type="checkbox" data-key="baby_cleanser"><div class="item"><div class="name">ì—‰ë©ì´í´ë Œì € ì†Œë¶„</div><div class="note">íœ´ëŒ€ìš©</div></div></li>
      </ul>
    </section>

    <!-- ì•„ê¸° ìê¸°/ì™¸ì¶œ -->
    <section class="card" data-card="baby_sleep">
      <h2>ğŸŒ™ ì•„ê¸° | ìê¸°/ì™¸ì¶œ <span class="progress"><span class="bar"><span class="fill"></span></span><span class="pct">0%</span></span></h2>
      <div class="section">
        <h3>ìˆ˜ë©´</h3>
        <ul>
          <li><input type="checkbox" data-key="baby_mat"><div class="item"><div class="name">ê¹”ê²ƒ 1</div><div class="note">ëˆ•í˜/êµí™˜ìš©</div></div></li>
          <li><input type="checkbox" data-key="baby_blanket"><div class="item"><div class="name">ë‹´ìš”(ë˜ëŠ” í° ìˆ˜ê±´)</div><div class="note">ì˜¨ë„ì°¨ ëŒ€ë¹„</div></div></li>
        </ul>
      </div>
      <div class="section">
        <h3>ì´ë™</h3>
        <ul>
          <li><input type="checkbox" data-key="baby_stroller"><div class="item"><div class="name">ìœ ëª¨ì°¨(ì»¤ë²„/ì¼€ì´ìŠ¤)</div><div class="note">íŠ¸ë í¬ ê³µê°„ ì²´í¬</div></div></li>
          <li><input type="checkbox" data-key="baby_wipes_big"><div class="item"><div class="name">ë¬¼í‹°ìŠˆ í°ê±° 1í†µ</div><div class="note">ë©”ì¸ ì¬ê³ </div></div></li>
          <li><input type="checkbox" data-key="baby_wipes_small"><div class="item"><div class="name">ë¬¼í‹°ìŠˆ íœ´ëŒ€ìš© 3ê°œ</div><div class="note">ì™¸ì¶œ ê°€ë°©</div></div></li>
          <li><input type="checkbox" data-key="baby_handwash"><div class="item"><div class="name">í•¸ë“œì›Œì‹œ(íœ´ëŒ€)</div><div class="note">ì™¸ì¶œ ì‹œ</div></div></li>
        </ul>
      </div>
    </section>

    <!-- ì•„ê¸° ìƒë¹„ì•½ -->
    <section class="card" data-card="baby_meds">
      <h2>ğŸ§° ì•„ê¸° | ìƒë¹„ì•½ <span class="progress"><span class="bar"><span class="fill"></span></span><span class="pct">0%</span></span></h2>
      <ul>
        <li><input type="checkbox" data-key="meds_physio"><div class="item"><div class="name">í”¼ì§€ì˜¤ë¨¸ ì†Œë¶„</div><div class="note">ì½”ë§‰í˜ ëŒ€ë¹„</div></div></li>
        <li><input type="checkbox" data-key="meds_cotton"><div class="item"><div class="name">ë©´ë´‰</div><div class="note">ìœ„ìƒ/ì¼€ì–´</div></div></li>
        <li><input type="checkbox" data-key="meds_bepanthen"><div class="item"><div class="name">ë¹„íŒí…</div><div class="note">ë°œì§„/ìê·¹</div></div></li>
        <li><input type="checkbox" data-key="meds_fever"><div class="item"><div class="name">í•´ì—´ì œ</div><div class="note">ë¹„ìƒìš©</div></div></li>
      </ul>
    </section>

    <!-- ì—„ë§ˆ -->
    <section class="card" data-card="mom">
      <h2>ğŸ‘© ì—„ë§ˆ | ì—¬í–‰ ê¸°ë³¸ <span class="progress"><span class="bar"><span class="fill"></span></span><span class="pct">0%</span></span></h2>
      <div class="section">
        <h3>ì†ì˜·/ì–‘ë§(5ì¼ + ì˜ˆë¹„)</h3>
        <ul>
          <li><input type="checkbox" data-key="mom_underwear"><div class="item"><div class="name">íŒ¬í‹° 6~7ì¥</div><div class="note">êµì²´ ì¦ìŒ</div></div></li>
          <li><input type="checkbox" data-key="mom_bra"><div class="item"><div class="name">ë¸Œë¼ 2~3ê°œ (ìˆ˜ìœ ë¸Œë¼)</div><div class="note">ë•€/ìœ ì¦™/ì„¸íƒ</div></div></li>
          <li><input type="checkbox" data-key="mom_socks"><div class="item"><div class="name">ì–‘ë§ 6ì¼¤ë ˆ</div><div class="note">ì‹¤ë‚´Â·ì™¸ì¶œ</div></div></li>
          <li><input type="checkbox" data-key="mom_pads"><div class="item"><div class="name">ìˆ˜ìœ íŒ¨ë“œ(ì¼íšŒìš©)</div><div class="note">ìƒˆëŠ” ë‚  ëŒ€ë¹„</div></div></li>
        </ul>
      </div>
      <div class="section">
        <h3>ì˜ë¥˜</h3>
        <ul>
          <li><input type="checkbox" data-key="mom_tops"><div class="item"><div class="name">ìƒì˜ 4~5ë²Œ</div><div class="note">ìˆ˜ìœ /ì•ˆê¸° í¸í•œ ì˜·</div></div></li>
          <li><input type="checkbox" data-key="mom_bottoms"><div class="item"><div class="name">í•˜ì˜ 2~3ë²Œ</div><div class="note">ìš´ì „/ìœ ëª¨ì°¨</div></div></li>
          <li><input type="checkbox" data-key="mom_sleepwear"><div class="item"><div class="name">ì ì˜· 2ë²Œ</div><div class="note">ë°¤ ìˆ˜ìœ </div></div></li>
          <li><input type="checkbox" data-key="mom_outer"><div class="item"><div class="name">ê°€ë””ê±´/ë°”ëŒë§‰ì´ 1</div><div class="note">ì œì£¼ ë°”ëŒ</div></div></li>
        </ul>
      </div>
      <div class="section">
        <h3>ì„¸ë©´/í™”ì¥í’ˆ</h3>
        <ul>
          <li><input type="checkbox" data-key="mom_skincare"><div class="item"><div class="name">ìŠ¤í‚¨ì¼€ì–´</div><div class="note">ì†Œë¶„</div></div></li>
          <li><input type="checkbox" data-key="mom_sunscreen"><div class="item"><div class="name">ì„ í¬ë¦¼</div><div class="note">ìœ ëª¨ì°¨ ì‚°ì±…</div></div></li>
          <li><input type="checkbox" data-key="mom_cleanser"><div class="item"><div class="name">í´ë Œì§•</div><div class="note">ë°¤ ì²´ë ¥ ì ˆì•½</div></div></li>
          <li><input type="checkbox" data-key="mom_lipbalm"><div class="item"><div class="name">ë¦½ë°¤</div><div class="note">ë°”ëŒ</div></div></li>
          <li><input type="checkbox" data-key="mom_hairtie"><div class="item"><div class="name">ë¨¸ë¦¬ëˆ/ì§‘ê²Œí•€</div><div class="note">í•„ìˆ˜</div></div></li>
        </ul>
      </div>
      <div class="section">
        <h3>ìˆ˜ìœ /íšŒë³µ</h3>
        <ul>
          <li><input type="checkbox" data-key="mom_nursing_cover"><div class="item"><div class="name">ìˆ˜ìœ ì»¤ë²„</div><div class="note">ì™¸ë¶€ ìˆ˜ìœ </div></div></li>
          <li><input type="checkbox" data-key="mom_wrist_guard"><div class="item"><div class="name">ì†ëª© ë³´í˜¸ëŒ€</div><div class="note">ë¶€ë‹´ ì™„í™”</div></div></li>
          <li><input type="checkbox" data-key="mom_waterbottle"><div class="item"><div class="name">í…€ë¸”ëŸ¬/ë¬¼ë³‘</div><div class="note">ê°ˆì¦ ëŒ€ë¹„</div></div></li>
        </ul>
      </div>
      <div class="section">
        <h3>ê°œì¸ ìœ„ìƒ/ìƒë¹„</h3>
        <ul>
          <li><input type="checkbox" data-key="mom_meds"><div class="item"><div class="name">ê°œì¸ ìƒë¹„ì•½</div><div class="note">ë‘í†µ/ì†Œí™”</div></div></li>
          <li><input type="checkbox" data-key="mom_sanitary"><div class="item"><div class="name">ìƒë¦¬ëŒ€/ë¼ì´ë„ˆ</div><div class="note">í•„ìš” ì‹œ</div></div></li>
          <li><input type="checkbox" data-key="mom_mask"><div class="item"><div class="name">ë§ˆìŠ¤í¬</div><div class="note">ë¹„í–‰ê¸°/ì‹¤ë‚´</div></div></li>
        </ul>
      </div>
    </section>

    <!-- ì•„ë¹  -->
    <section class="card" data-card="dad">
      <h2>ğŸ‘¨ ì•„ë¹  | ì—¬í–‰ ê¸°ë³¸ <span class="progress"><span class="bar"><span class="fill"></span></span><span class="pct">0%</span></span></h2>
      <div class="section">
        <h3>ì†ì˜·/ì–‘ë§(5ì¼ + ì˜ˆë¹„)</h3>
        <ul>
          <li><input type="checkbox" data-key="dad_underwear"><div class="item"><div class="name">íŒ¬í‹° 6~7ì¥</div><div class="note">ì—¬ìœ </div></div></li>
          <li><input type="checkbox" data-key="dad_socks"><div class="item"><div class="name">ì–‘ë§ 6ì¼¤ë ˆ</div><div class="note">ìš´ì „/ì™¸ì¶œ</div></div></li>
        </ul>
      </div>
      <div class="section">
        <h3>ì˜ë¥˜</h3>
        <ul>
          <li><input type="checkbox" data-key="dad_tops"><div class="item"><div class="name">ìƒì˜ 4~5ë²Œ</div><div class="note">ë¯¸íŒ… ìˆìœ¼ë©´ ì…”ì¸ </div></div></li>
          <li><input type="checkbox" data-key="dad_bottoms"><div class="item"><div class="name">í•˜ì˜ 2~3ë²Œ</div><div class="note">ìš´ì „ í¸í•œ ë°”ì§€</div></div></li>
          <li><input type="checkbox" data-key="dad_sleepwear"><div class="item"><div class="name">ì ì˜· 1~2ë²Œ</div><div class="note">ìˆ™ë©´</div></div></li>
          <li><input type="checkbox" data-key="dad_outer"><div class="item"><div class="name">ë°”ëŒë§‰ì´/í›„ë“œ 1</div><div class="note">ì œì£¼ ë°”ëŒ</div></div></li>
          <li><input type="checkbox" data-key="dad_shoes"><div class="item"><div class="name">í¸í•œ ì‹ ë°œ 1</div><div class="note">ì´ë™</div></div></li>
        </ul>
      </div>
      <div class="section">
        <h3>ì„¸ë©´/ìœ„ìƒ</h3>
        <ul>
          <li><input type="checkbox" data-key="dad_toiletries"><div class="item"><div class="name">ì¹«ì†”/ì¹˜ì•½/ë©´ë„ê¸°</div><div class="note">ê¸°ë³¸</div></div></li>
          <li><input type="checkbox" data-key="dad_lotion"><div class="item"><div class="name">ë¡œì…˜/ë¦½ë°¤</div><div class="note">ê±´ì¡°</div></div></li>
          <li><input type="checkbox" data-key="dad_sunscreen"><div class="item"><div class="name">ì„ í¬ë¦¼</div><div class="note">ì•¼ì™¸</div></div></li>
        </ul>
      </div>
      <div class="section">
        <h3>ì—­í•  íŠ¹í™”</h3>
        <ul>
          <li><input type="checkbox" data-key="dad_license"><div class="item"><div class="name">ìš´ì „ë©´í—ˆì¦</div><div class="note">ë Œí„°ì¹´</div></div></li>
          <li><input type="checkbox" data-key="dad_crossbag"><div class="item"><div class="name">í¬ë¡œìŠ¤ë°±/í—ˆë¦¬íŒ©</div><div class="note">ì¦‰ì‹œ ëŒ€ì‘ìš©</div></div></li>
          <li><input type="checkbox" data-key="dad_sunglasses"><div class="item"><div class="name">ì„ ê¸€ë¼ìŠ¤</div><div class="note">ìš´ì „</div></div></li>
          <li><input type="checkbox" data-key="dad_hat"><div class="item"><div class="name">ëª¨ì</div><div class="note">í–‡ë¹›</div></div></li>
          <li><input type="checkbox" data-key="dad_patches"><div class="item"><div class="name">íŒŒìŠ¤/ê·¼ìœ¡í†µ íŒ¨ì¹˜</div><div class="note">í—ˆë¦¬/ì–´ê¹¨</div></div></li>
          <li><input type="checkbox" data-key="dad_snacks"><div class="item"><div class="name">ê°„ë‹¨ ê°„ì‹</div><div class="note">íƒ€ì´ë°</div></div></li>
        </ul>
      </div>
    </section>

    <!-- ê³µìš© ì¶œì¥ -->
    <section class="card full" data-card="work">
      <h2>ğŸ’¼ ê³µìš© | ì¶œì¥/ì „ì <span class="progress"><span class="bar"><span class="fill"></span></span><span class="pct">0%</span></span></h2>
      <ul>
        <li><input type="checkbox" data-key="work_laptop"><div class="item"><div class="name">ë…¸íŠ¸ë¶/ì¶©ì „ê¸°</div><div class="note">ì—…ë¬´</div></div></li>
        <li><input type="checkbox" data-key="work_docs"><div class="item"><div class="name">ì¶œì¥ ì„œë¥˜/ëª…í•¨/í•„ê¸°êµ¬</div><div class="note">ê³ ì • ìœ„ì¹˜</div></div></li>
        <li><input type="checkbox" data-key="work_adapter"><div class="item"><div class="name">ë©€í‹°íƒ­/ì–´ëŒ‘í„°</div><div class="note">í¬íŠ¸ ë¶€ì¡±</div></div></li>
      </ul>
    </section>
  </main>

  <!-- Edit Modal -->
  <div class="modal-overlay" id="editModal">
    <div class="modal">
      <h3>âœï¸ í•­ëª© ìˆ˜ì •</h3>
      <div class="field">
        <label>ì´ë¦„</label>
        <input type="text" id="edit_name" />
      </div>
      <div class="field">
        <label>ë©”ëª¨</label>
        <input type="text" id="edit_note" />
      </div>
      <div class="field">
        <label>ì¹´í…Œê³ ë¦¬</label>
        <select id="edit_category">
          <option value="custom_baby">ì•„ê¸° | ì¶”ê°€</option>
          <option value="custom_mom">ì—„ë§ˆ | ì¶”ê°€</option>
          <option value="custom_dad">ì•„ë¹  | ì¶”ê°€</option>
          <option value="custom_shared">ê³µìš© | ì¶”ê°€</option>
        </select>
      </div>
      <input type="hidden" id="edit_id" />
      <div class="modal-actions">
        <button type="button" onclick="closeEditModal()">ì·¨ì†Œ</button>
        <button type="button" class="btn-primary" onclick="saveEdit()">ì €ì¥</button>
      </div>
    </div>
  </div>

  <div class="toast" id="toast">ì €ì¥í–ˆì–´ìš”</div>
  <input id="import_file" type="file" accept="application/json" style="display:none" />

  <script>
    const STATE_KEY = "jeju_baby_trip_state_v4";
    const CUSTOM_KEY = "jeju_baby_trip_custom_v4";

    function toast(msg){
      const t = document.getElementById('toast');
      t.textContent = msg;
      t.classList.add('show');
      setTimeout(()=>t.classList.remove('show'), 1500);
    }

    function getAllCheckboxes(){
      return Array.from(document.querySelectorAll('input[type="checkbox"][data-key]'));
    }

    function loadState(){
      try{
        const saved = JSON.parse(localStorage.getItem(STATE_KEY) || "{}");
        getAllCheckboxes().forEach(cb => { cb.checked = !!saved[cb.dataset.key]; });
      }catch(e){}
    }

    function saveState(){
      const obj = {};
      getAllCheckboxes().forEach(cb => obj[cb.dataset.key] = cb.checked);
      localStorage.setItem(STATE_KEY, JSON.stringify(obj));
    }

    function loadCustom(){
      try{ return JSON.parse(localStorage.getItem(CUSTOM_KEY) || "[]"); }
      catch(e){ return []; }
    }

    function saveCustom(items){
      localStorage.setItem(CUSTOM_KEY, JSON.stringify(items));
    }

    function escapeHtml(s){
      return (s||"").replace(/[&<>"']/g, (c)=>({ "&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;" }[c]));
    }

    function renderCustom(){
      const items = loadCustom();
      const byCat = {custom_baby:[],custom_mom:[],custom_dad:[],custom_shared:[]};
      items.forEach(it => { if(byCat[it.category]) byCat[it.category].push(it); });

      Object.keys(byCat).forEach(cat=>{
        const ul = document.getElementById("list_" + cat);
        const empty = document.getElementById("empty_" + cat);
        ul.innerHTML = "";
        if(byCat[cat].length === 0){ empty.style.display = "block"; return; }
        empty.style.display = "none";

        byCat[cat].forEach(it=>{
          const li = document.createElement("li");
          li.innerHTML = `
            <input type="checkbox" ${it.checked ? "checked":""} data-custom-id="${escapeHtml(it.id)}">
            <div class="item">
              <div class="name">${escapeHtml(it.name)}</div>
              ${it.note ? `<div class="note">${escapeHtml(it.note)}</div>` : ``}
            </div>
            <div class="row-actions">
              <button class="iconbtn btn-edit" type="button" data-edit-id="${escapeHtml(it.id)}">ìˆ˜ì •</button>
              <button class="iconbtn btn-danger" type="button" data-del-id="${escapeHtml(it.id)}">ì‚­ì œ</button>
            </div>
          `;
          ul.appendChild(li);
        });
      });

      // Checkbox listeners
      document.querySelectorAll('input[type="checkbox"][data-custom-id]').forEach(cb=>{
        cb.addEventListener('change', ()=>{
          const id = cb.getAttribute('data-custom-id');
          const items = loadCustom();
          const idx = items.findIndex(x=>x.id===id);
          if(idx>=0){ items[idx].checked = cb.checked; saveCustom(items); updateOverall(); }
        });
      });

      // Delete listeners
      document.querySelectorAll('button[data-del-id]').forEach(btn=>{
        btn.addEventListener('click', ()=>{
          if(!confirm('ì‚­ì œí• ê¹Œìš”?')) return;
          const id = btn.getAttribute('data-del-id');
          const items = loadCustom().filter(x=>x.id!==id);
          saveCustom(items);
          renderCustom();
          updateOverall();
          toast("ì‚­ì œí–ˆì–´ìš”");
        });
      });

      // Edit listeners
      document.querySelectorAll('button[data-edit-id]').forEach(btn=>{
        btn.addEventListener('click', ()=>{
          const id = btn.getAttribute('data-edit-id');
          openEditModal(id);
        });
      });
    }

    function addCustomItem(){
      const name = document.getElementById('add_name').value.trim();
      const note = document.getElementById('add_note').value.trim();
      const category = document.getElementById('add_category').value;

      if(!name){ toast("ì´ë¦„ì„ ì…ë ¥í•´ì¤˜"); return; }

      const items = loadCustom();
      const id = "c_" + Date.now().toString(36) + "_" + Math.random().toString(36).slice(2,7);
      items.unshift({id, category, name, note, checked:false});
      saveCustom(items);

      document.getElementById('add_name').value = "";
      document.getElementById('add_note').value = "";

      renderCustom();
      updateOverall();
      toast("ì¶”ê°€í–ˆì–´ìš”");
    }

    // Edit Modal
    function openEditModal(id){
      const items = loadCustom();
      const item = items.find(x=>x.id===id);
      if(!item) return;

      document.getElementById('edit_id').value = id;
      document.getElementById('edit_name').value = item.name;
      document.getElementById('edit_note').value = item.note || '';
      document.getElementById('edit_category').value = item.category;
      document.getElementById('editModal').classList.add('show');
    }

    function closeEditModal(){
      document.getElementById('editModal').classList.remove('show');
    }

    function saveEdit(){
      const id = document.getElementById('edit_id').value;
      const name = document.getElementById('edit_name').value.trim();
      const note = document.getElementById('edit_note').value.trim();
      const category = document.getElementById('edit_category').value;

      if(!name){ toast("ì´ë¦„ì„ ì…ë ¥í•´ì¤˜"); return; }

      const items = loadCustom();
      const idx = items.findIndex(x=>x.id===id);
      if(idx>=0){
        items[idx].name = name;
        items[idx].note = note;
        items[idx].category = category;
        saveCustom(items);
        renderCustom();
        updateOverall();
        toast("ìˆ˜ì •í–ˆì–´ìš”");
      }
      closeEditModal();
    }

    function updateCardProgress(card){
      if(card.getAttribute('data-card') === 'custom_add'){
        const pct = card.querySelector('.pct');
        const fill = card.querySelector('.fill');
        if(pct) pct.textContent = "â€”";
        if(fill) fill.style.width = "0%";
        return {done:0,total:0};
      }
      const cbs = Array.from(card.querySelectorAll('input[type="checkbox"][data-key], input[type="checkbox"][data-custom-id]'));
      const done = cbs.filter(x => x.checked).length;
      const total = cbs.length || 1;
      const pct = Math.round((done/total)*100);
      const pctEl = card.querySelector('.pct');
      const fillEl = card.querySelector('.fill');
      if(pctEl) pctEl.textContent = total > 0 ? pct + "%" : "0%";
      if(fillEl) fillEl.style.width = pct + "%";
      return {done,total};
    }

    function updateOverall(){
      const cards = Array.from(document.querySelectorAll('[data-card]'));
      let done = 0, total = 0;
      cards.forEach(card => { const r = updateCardProgress(card); done += r.done; total += r.total; });
      const pct = total ? Math.round((done/total)*100) : 0;
      document.getElementById('overall').textContent = `ì „ì²´ ${pct}% (${done}/${total})`;
    }

    function bindBuiltInCheckboxes(){
      getAllCheckboxes().forEach(cb => cb.addEventListener('change', () => {
        saveState();
        updateOverall();
      }));
    }

    function checkAll(flag){
      getAllCheckboxes().forEach(cb => cb.checked = flag);
      const items = loadCustom();
      items.forEach(it => it.checked = flag);
      saveCustom(items);
      saveState();
      renderCustom();
      updateOverall();
    }

    function getFullBackupData(){
      return {
        version: 4,
        createdAt: new Date().toISOString(),
        state: JSON.parse(localStorage.getItem(STATE_KEY) || "{}"),
        custom: loadCustom()
      };
    }

    function exportBackup(){
      const payload = getFullBackupData();
      const blob = new Blob([JSON.stringify(payload, null, 2)], {type:"application/json"});
      const a = document.createElement('a');
      const dt = new Date();
      const y = dt.getFullYear();
      const m = String(dt.getMonth()+1).padStart(2,'0');
      const d = String(dt.getDate()).padStart(2,'0');
      a.download = `jeju-checklist-${y}${m}${d}.json`;
      a.href = URL.createObjectURL(blob);
      a.click();
      URL.revokeObjectURL(a.href);
      toast("ë°±ì—… íŒŒì¼ ì €ì¥ë¨");
    }

    async function shareState(){
      const payload = getFullBackupData();
      const jsonStr = JSON.stringify(payload);

      // Try Web Share API with file (best for mobile)
      if(navigator.canShare && navigator.canShare({files: [new File([], 'test.json')]})){
        try {
          const dt = new Date();
          const filename = `jeju-checklist-${dt.getFullYear()}${String(dt.getMonth()+1).padStart(2,'0')}${String(dt.getDate()).padStart(2,'0')}.json`;
          const file = new File([jsonStr], filename, {type: 'application/json'});
          await navigator.share({
            title: 'ì œì£¼ ì²´í¬ë¦¬ìŠ¤íŠ¸ ê³µìœ ',
            text: 'ì²´í¬ë¦¬ìŠ¤íŠ¸ ìƒíƒœë¥¼ ê³µìœ í•©ë‹ˆë‹¤',
            files: [file]
          });
          toast("ê³µìœ  ì™„ë£Œ!");
          return;
        } catch(e) {
          if(e.name !== 'AbortError') console.log('File share failed, trying text share');
        }
      }

      // Fallback: Share as text (URL with encoded data)
      if(navigator.share){
        try {
          // Compress and encode for URL
          const encoded = btoa(unescape(encodeURIComponent(jsonStr)));
          const currentUrl = window.location.href.split('?')[0];
          const shareUrl = currentUrl + '?data=' + encoded;

          // If URL too long, just share the JSON as text
          if(shareUrl.length > 2000) {
            await navigator.share({
              title: 'ì œì£¼ ì²´í¬ë¦¬ìŠ¤íŠ¸',
              text: 'ì•„ë˜ ë‚´ìš©ì„ ë³µì‚¬í•´ì„œ "ë°±ì—… ë¶ˆëŸ¬ì˜¤ê¸°"ì— ì‚¬ìš©í•˜ì„¸ìš”:\n\n' + jsonStr
            });
          } else {
            await navigator.share({
              title: 'ì œì£¼ ì²´í¬ë¦¬ìŠ¤íŠ¸',
              text: 'ì²´í¬ë¦¬ìŠ¤íŠ¸ë¥¼ ê³µìœ í•©ë‹ˆë‹¤',
              url: shareUrl
            });
          }
          toast("ê³µìœ  ì™„ë£Œ!");
          return;
        } catch(e) {
          if(e.name === 'AbortError') return;
        }
      }

      // Final fallback: Copy to clipboard
      try {
        await navigator.clipboard.writeText(jsonStr);
        toast("í´ë¦½ë³´ë“œì— ë³µì‚¬ë¨! ì¹´í†¡ì— ë¶™ì—¬ë„£ê¸° í•˜ì„¸ìš”");
      } catch(e) {
        // Really old browser fallback
        exportBackup();
      }
    }

    function triggerImport(){
      document.getElementById('import_file').click();
    }

    function importData(data){
      if(data.state && typeof data.state === "object"){
        localStorage.setItem(STATE_KEY, JSON.stringify(data.state));
      }
      if(Array.isArray(data.custom)){
        localStorage.setItem(CUSTOM_KEY, JSON.stringify(data.custom));
      }
      loadState();
      renderCustom();
      updateOverall();
      toast("ë¶ˆëŸ¬ì™”ì–´ìš”!");
    }

    document.getElementById('import_file').addEventListener('change', async (e)=>{
      const file = e.target.files && e.target.files[0];
      if(!file) return;
      try{
        const text = await file.text();
        const data = JSON.parse(text);
        importData(data);
      }catch(err){
        toast("ë¶ˆëŸ¬ì˜¤ê¸° ì‹¤íŒ¨");
      }finally{
        e.target.value = "";
      }
    });

    // Check for shared data in URL
    function checkUrlData(){
      const params = new URLSearchParams(window.location.search);
      const data = params.get('data');
      if(data){
        try {
          const decoded = decodeURIComponent(escape(atob(data)));
          const parsed = JSON.parse(decoded);
          if(confirm('ê³µìœ ë°›ì€ ì²´í¬ë¦¬ìŠ¤íŠ¸ë¥¼ ë¶ˆëŸ¬ì˜¬ê¹Œìš”?')){
            importData(parsed);
          }
          // Clean URL
          window.history.replaceState({}, '', window.location.pathname);
        } catch(e) {
          console.log('Failed to parse shared data');
        }
      }
    }

    // Close modal on overlay click
    document.getElementById('editModal').addEventListener('click', (e)=>{
      if(e.target.id === 'editModal') closeEditModal();
    });

    // Close modal on Escape
    document.addEventListener('keydown', (e)=>{
      if(e.key === 'Escape') closeEditModal();
      if(e.key === 'Enter'){
        const modal = document.getElementById('editModal');
        if(modal.classList.contains('show')){
          saveEdit();
        } else {
          const active = document.activeElement;
          if(active && (active.id === 'add_name' || active.id === 'add_note')){
            addCustomItem();
          }
        }
      }
    });

    // Expose functions
    window.checkAll = checkAll;
    window.addCustomItem = addCustomItem;
    window.exportBackup = exportBackup;
    window.shareState = shareState;
    window.triggerImport = triggerImport;
    window.openEditModal = openEditModal;
    window.closeEditModal = closeEditModal;
    window.saveEdit = saveEdit;

    // Init
    loadState();
    bindBuiltInCheckboxes();
    renderCustom();
    updateOverall();
    checkUrlData();
  </script>
</body>
</html>
